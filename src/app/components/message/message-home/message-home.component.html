<app-navigation></app-navigation>

<section class="message-container">
    <div class="container">
        <!-- registraion middle container -->
        <div class="row mess_block">
            <!-- left section -->
            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12 mess_left with_border_right">
                <div class="row p-24">
                    <div class="c-text_lg">Messages
                        <!-- <button type="button" class="btn btn-primary btn-md pull-right" (click)="composeNewMessage()" >
                            <span class="btn-label-icon2 m-r-5"></span> compose
                        </button> -->
                    </div>
                </div>
                <div class="row p-l-r-24">
                    <div class="c-form__group c-form--md c-form--noeffect c-form__faded--sm m-0">
                        <input class="c-form__input p-l-24" type="text" [formControl]="msgUserSearch" >
                        <label class="p-l-16">Search</label>
                        <span>
                        <img *ngIf="!isSearching" [src]="imageBaseUrl + 'img/svg/ico_search.svg'" class="c-form__input--lefticon">
                        <img *ngIf="isSearching" [src]="imageBaseUrl + 'img/search-preloader.gif'" class="c-form__input--lefticon">
                    </span>
                    </div>
                </div>
                <div class="row p-l-r-24 p-t-b-8">
                    <div class="col-md-7 c-text_md c-checkbox__md2 p-l-0">
                        <label class="checkbox-inline p-l-0 m-t-8">
                            <input type="checkbox" value="1"> Select all
                        </label>
                    </div>
                    <div class="col-md-5">
                        <div class="c-form__group m-0">
                            <select class="c-form-control with_border_none">
                                <option>Action1</option>
                                <option>Action2</option>
                                <option>Action3</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div *ngIf="messangerList && messangerList?.length > 0" class="mess_list row" id="ops_scrollbar">
                    <div *ngFor="let user of messangerList" class="row with_border_bottom with_border_top" [ngClass]="{'msg__unread': !user.isRead }">
                        <div class="c-checkbox__md2 col-md-2">
                            <label class="checkbox-inline pull-right m-t-24">
                                <input type="checkbox" value="1">
                            </label>
                        </div>
                        <div class="col-md-10 p-l-0">
                            <div class="dropdown__item p-t-b-16" (click)="selectUser(user)">
                                <div class="dropnoti__avatar">
                                    <img *ngIf="user?.profileImage === ''" class="navdrop__img" [src]="imageBaseUrl + 'avatars/user-avatar-male.png'">
                                    <img *ngIf="user?.profileImage !== ''" class="navdrop__img" [src]="imageBaseUrl + user?.profileImage">
                                </div>
                                <div class="dropnoti__detail">
                                    <p class="dropnoti__bold color-grey-darker">{{ user?.name }}</p>
                                    <p>{{ user?.latestMessage }}</p>
                                </div>
                                <p class="msg__time2">{{ user?.time | utcDate | date:'d MMM hh:mm a' }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-8 col-md-8 col-sm-8 col-xs-12 mess_right">
                <div class="c-text_lg p-t-b-24">
                    Message with <strong>{{ selectedUser?.name }}</strong>
                    <div class="dropdown c-dropdown pull-right">
                        <p class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                            <img [src]="imageBaseUrl + 'img/svg/ico_settings.svg'" class="mess_set_icon">
                        </p>
                        <ul class="dropdown-menu">
                            <li class="with_border_bottom">
                                <a href="#">
                                    <img [src]="imageBaseUrl + 'img/svg/ico_archive.svg'" class="mess_set_icon"> &nbsp;
                                    <span>Archive</span>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <img [src]="imageBaseUrl + 'img/svg/ico_delete.svg'" class="mess_set_icon"> &nbsp;
                                    <span>Delete</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- preloader -->
                <div *ngIf="showPreloader === true">
                    <div class="sticky">
                        <div class="loader">Loading...</div>
                    </div>
                </div>
                <!-- preloader -->
                
                <ng-container *ngIf="showPreloader === false">
                    <!-- message container -->
                    <!-- <div class="mess_chat_block" #chatWindow [scrollTop]="chatWindow.scrollHeight" -->
                    <div class="mess_chat_block" id="ops_scrollbar" #chatWindow [scrollTop]="chatWindow.scrollHeight"
                        infiniteScroll
                        [infiniteScrollDistance]="5"
                        [infiniteScrollThrottle]="50"
                        [scrollWindow]="false"
                        (scrolled)="onScrollDown()"
                        (scrolledUp)="onScrollUp()">
                        <ng-container *ngIf="conversation?.length > 0">
                            <div *ngFor="let message of conversation" class="msg_container">
                                <div class="col-md-12" *ngIf="message?.messageType === 'sent'">
                                    <ul class="list-inline">
                                        <li class="list-inline-item avatar_msg_input float_right">
                                            <img *ngIf="message?.profileImage === ''" [src]="imageBaseUrl + 'avatars/user-avatar-male.png'" class="img-responsive">
                                            <img *ngIf="message?.profileImage !== ''" [src]="imageBaseUrl + message?.profileImage" class="img-responsive">
                                        </li>
                                        <li class="list-inline-item msg_cont_block2">
                                            <p class="ops_msg_aero2">{{ message?.content }}</p>
                                            <div class="msg_sent_time2">{{ message?.time | utcDate | date:'d MMM hh:mm a' }}</div>
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-12" *ngIf="message?.messageType !== 'sent'">
                                    <ul class="list-inline">
                                        <li class="list-inline-item avatar_msg_input float_left">
                                            <img *ngIf="message?.profileImage === ''" [src]="imageBaseUrl + 'avatars/user-avatar-male.png'" class="img-responsive">
                                            <img *ngIf="message?.profileImage !== ''" [src]="imageBaseUrl + message?.profileImage" class="img-responsive">
                                        </li>
                                        <li class="list-inline-item msg_cont_block">
                                            <p class="ops_msg_aero">{{ message?.content }}</p>
                                            <div class="msg_sent_time">{{ message?.time | utcDate | date:'d MMM hh:mm a' }}</div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </ng-container>
                    </div>
                    <!-- //message container -->
    
                    <!-- message input block -->
                    <div class="row">
                        <div class="col-md-1">
                            <div class="c-user__avatar c-avatar--feed3 m-t-16">
                                <img class="c-user__image" [src]="imageBaseUrl + 'avatars/user-avatar-male.png'">
                            </div>
                        </div>
                        <div class="col-md-11 p-l-0">
                            <div class="c-form__group c-form--md c-form--noeffect c-form__faded--md">
                                <!-- <input class="c-form__input" type="text" #inputMessageText="ngModel" [(ngModel)]="messageText" [ngModelOptions]="{standalone: true}"> -->
                                <!-- <input class="c-form__input" type="text" [(ngModel)]="messageText" (keyup)="userIsTyping()" (keyup.enter)="sendMessage()"> -->
                                <input class="c-form__input" type="text" [(ngModel)]="messageText" (keyup)="userIsTyping($event)">
                                <label>Message</label>
                            </div>
                        </div>
                    </div>
                    <!-- //message input block -->
                </ng-container>

                <!-- <ng-template *ngIf="!isUserSelected()">
                    <p>Select user</p>
                </ng-template> -->
            </div>
        </div>
        <!-- //registraion middle container -->
    </div>
</section>